!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("library",[],t):"object"==typeof exports?exports.library=t():e.library=t()}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=11)}([function(e,t){e.exports=require("qs")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePath=void 0;var n,a=r(0),o=(n=a)&&n.__esModule?n:{default:n};t.parsePath=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{removePathFromCacheKey:!1,parseNestedRoutes:!1},r=e.params.query||{},n=t.removePathFromCacheKey,a=t.parseNestedRoutes,u=n&&e.id?"":""+e.path;return!n&&a&&(u=function(e,t){for(var r=new RegExp(":([^\\/\\?]+)\\??","g"),n=null;null!==(n=r.exec(e));)Object.keys(t.route).includes(n[1])&&(e=e.replace(n[0],t.route[n[1]]));return e}(u,e.params)),e.id?(0===u.length||n||(u+="/"),Object.keys(r).length>0?u+=e.id+"?"+o.default.stringify(r,{encode:!1}):u+=""+e.id):Object.keys(r).length>0&&(u+="?"+o.default.stringify(r,{encode:!1})),u}},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("moment")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.before=function(e){return e=Object.assign({},s,e),function(e){return new Promise(function(t){var r=e.app.get("redisClient"),u=e.app.get("redisCache"),s=u.env||"production",c=(0,o.parsePath)(e,u);r.get(c,function(r,o){if(null!==r&&t(e),o){var u=JSON.parse(o),i=(0,n.default)(u.cache.expiresOn).format("DD MMMM YYYY - HH:mm:ss");e.result=u,t(e),"test"!==s&&(console.log(a.default.cyan("[redis]")+" returning cached value for "+a.default.green(c)+"."),console.log("> Expires on "+i+"."))}else t(e)})})}},t.after=function(e){return e=Object.assign({},s,e),function(e){return new Promise(function(t){if(!e.result.cache.cached){var r=e.app.get("redisCache"),u=r.env||"production",s=r.defaultDuration?r.defaultDuration:86400,c=e.result.cache.duration||s,i=e.app.get("redisClient"),l=(0,o.parsePath)(e,r);Object.assign(e.result.cache,{cached:!0,duration:c,expiresOn:(0,n.default)().add(n.default.duration(c,"seconds")),parent:e.path,group:e.path?"group-"+e.path:"",key:l}),i.set(l,JSON.stringify(e.result)),i.expire(l,e.result.cache.duration),e.path&&i.rpush(e.result.cache.group,l),"test"!==u&&(console.log(a.default.cyan("[redis]")+" added "+a.default.green(l)+" to the cache."),console.log("> Expires in "+n.default.duration(c,"seconds").humanize()+"."))}if(e.result.cache.hasOwnProperty("wrapped")){var f=e.result.cache.wrapped;e.result=f}t(e)})}};var n=u(r(3)),a=u(r(2)),o=r(1);function u(e){return e&&e.__esModule?e:{default:e}}var s={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cache=function(e){return e=Object.assign({},n,e),function(t){if(!t.result.hasOwnProperty("cache")){var r={};if(Array.isArray(t.result)){var n=t.result;r.wrapped=n,t.result={}}r=Object.assign({},r,{cached:!1,duration:e.duration||86400}),t.result.cache=r}return Promise.resolve(t)}},t.removeCacheInformation=function(e){return e=Object.assign({},n,e),function(e){return e.result.hasOwnProperty("cache")&&delete e.result.cache,Promise.resolve(e)}};var n={}},function(e,t){e.exports=require("redis")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return this.set("redisClient",o.default.createClient(this.get("redis"))),this};var n,a=r(6),o=(n=a)&&n.__esModule?n:{default:n};e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t}return n(e,[{key:"clearSingle",value:function(e){var t=this;return new Promise(function(r,n){t.client.del(""+e,function(e,t){e&&n(!1),1===t&&r(!0),r(!1)})})}},{key:"clearGroup",value:function(e){var t=this;return new Promise(function(r,n){t.client.lrange(e,0,-1,function(a,o){a&&n(a),t.clearAll(o).then(t.client.del(e,function(e,t){r(1===t)}))})})}},{key:"clearAll",value:function(e){var t=this;return new Promise(function(r){e.length||r(!1);for(var n=0;n<e.length;n++)t.clearSingle(e[n]).then(function(t){n===e.length-1&&r(t)})})}}]),e}();t.default=a,e.exports=t.default},function(e,t){e.exports=require("express")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(9)),a=o(r(8));function o(e){return e&&e.__esModule?e:{default:e}}var u=200,s=204,c=500;t.default=function(e){var t=n.default.Router(),r=e.get("redisClient"),o=new a.default(r);return t.get("/clear",function(e,t){r.flushall(),t.status(u).json({message:"Cache cleared",status:u})}),t.get("/clear/single/:target",function(e,t){var n=decodeURIComponent(e.params.target),a=e.query,i=a&&0!==Object.keys(a).length;n&&(i&&(n=decodeURIComponent(e.url.split("/")[3])),r.get(""+n,function(e,r){e?t.status(c).json({message:"something went wrong"+e.message}):r?o.clearSingle(n).then(function(e){t.status(u).json({message:"cache cleared for key ("+(i?"with":"without")+" params): "+n,status:u})}):t.status(u).json({message:"cache already cleared for key ("+(i?"with":"without")+" params): "+n,status:s})}))}),t.get("/clear/group/:target",function(e,t){var n=decodeURIComponent(e.params.target);n&&(n="group-"+n,r.lrange(n,0,-1,function(r,a){r?t.status(c).json({message:"something went wrong"+r.message}):a&&Array.isArray(a)&&a.length>0?o.clearGroup(n).then(function(r){t.status(u).json({message:"cache cleared for the group key: "+decodeURIComponent(e.params.target),status:u})}):t.status(u).json({message:"cache already cleared for the group key: "+decodeURIComponent(e.params.target),status:s})}))}),t},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(10)),a=s(r(7)),o=r(5),u=r(4);function s(e){return e&&e.__esModule?e:{default:e}}t.default={redisClient:a.default,cacheRoutes:n.default,hookCache:o.cache,hookRemoveCacheInformation:o.removeCacheInformation,redisBeforeHook:u.before,redisAfterHook:u.after},e.exports=t.default}])});
//# sourceMappingURL=library.min.js.map